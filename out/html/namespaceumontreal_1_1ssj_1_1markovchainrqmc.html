<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.14"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>umontreal::ssj::markovchainrqmc Namespace Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js", "TeX/AMSmath.js", "TeX/AMSsymbols.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script><script type="text/javascript" async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="ssj.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
    <td style="padding-left: 0.5em;">
    <div id="projectbrief">Stochastic Simulation in Java</div>
    </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.14 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><b>umontreal</b></li><li class="navelem"><b>ssj</b></li><li class="navelem"><a class="el" href="namespaceumontreal_1_1ssj_1_1markovchainrqmc.html">markovchainrqmc</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#nested-classes">Classes</a>  </div>
  <div class="headertitle">
<div class="title">umontreal::ssj::markovchainrqmc Namespace Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>Classes for the simulation of Markov chains with RQMC and Array-RQMC.  
<a href="#details">More...</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="nested-classes"></a>
Classes</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classumontreal_1_1ssj_1_1markovchainrqmc_1_1ArrayOfComparableChains.html">ArrayOfComparableChains</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">This class provides tools to simulate an array of <a class="el" href="classumontreal_1_1ssj_1_1markovchainrqmc_1_1MarkovChainComparable.html">MarkovChainComparable</a> objects with the array-RQMC method of <a class="el" href="citelist.html#CITEREF_vLEC08a">[135]</a>, <a class="el" href="citelist.html#CITEREF_vLEC09d">[138]</a>&thinsp;.  <a href="classumontreal_1_1ssj_1_1markovchainrqmc_1_1ArrayOfComparableChains.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classumontreal_1_1ssj_1_1markovchainrqmc_1_1ArrayOfDoubleChains.html">ArrayOfDoubleChains</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">Similar to <a class="el" href="classumontreal_1_1ssj_1_1markovchainrqmc_1_1ArrayOfComparableChains.html">ArrayOfComparableChains</a>, except that instead of working with \(n\) clones of a <a class="el" href="classumontreal_1_1ssj_1_1markovchainrqmc_1_1MarkovChain.html">MarkovChain</a>, we use a <em>single</em> <a class="el" href="classumontreal_1_1ssj_1_1markovchainrqmc_1_1MarkovChainDouble.html">MarkovChainDouble</a> object for all the chains.  <a href="classumontreal_1_1ssj_1_1markovchainrqmc_1_1ArrayOfDoubleChains.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classumontreal_1_1ssj_1_1markovchainrqmc_1_1MarkovChain.html">MarkovChain</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">This class defines a generic Markov chain and provides basic tools to simulate it for a given number of steps or until it stops and recover the performance measure.  <a href="classumontreal_1_1ssj_1_1markovchainrqmc_1_1MarkovChain.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classumontreal_1_1ssj_1_1markovchainrqmc_1_1MarkovChainComparable.html">MarkovChainComparable</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">A subclass of Markov chain for which there is a total ordering between the states in each dimension induced by the implementation of the <code>MultiDimComparable</code> interface in package <code><a class="el" href="namespaceumontreal_1_1ssj_1_1util.html" title="General basic utilities. ">umontreal.ssj.util</a></code>.  <a href="classumontreal_1_1ssj_1_1markovchainrqmc_1_1MarkovChainComparable.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classumontreal_1_1ssj_1_1markovchainrqmc_1_1MarkovChainDouble.html">MarkovChainDouble</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">A special kind of Markov chain whose state space is a subset of the real numbers.  <a href="classumontreal_1_1ssj_1_1markovchainrqmc_1_1MarkovChainDouble.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Classes for the simulation of Markov chains with RQMC and Array-RQMC. </p>
<p>Tools to simulate Markov chains with the Array-RQMC method.</p>
<p><a class="anchor" id="REF_markovchainrqmc_overview_sec_overview"></a> This package provides tools to implement and use discrete-time Markov chains (DTMC) and simulate them with RQMC methods.</p>
<p>A DTMC is an important class of Markovian processes with time index \(I=\{0,1,2,â€¦\}\). It is defined as a sequence \(\{X_i, i\in I\}\) of random variables ( \(X_i\) represents the state at index \(i\)), all defined on the same probability space. The evolution of the states is determined by the stochastic recurrence </p><p class="formulaDsp">
\[ X_0 = x_0, \qquad X_j = \varphi(X_{j-1},U_j), \]
</p>
<p> where the \(U_j\) are independent random variables uniformly distributed over \([0,1)^d\). Here, the dimension \(d\) is usually 1, but can be larger.</p>
<p>A performance mesure \(Y_i\) is defined over this sequence as </p><p class="formulaDsp">
\[ Y_i = \sum_{j=1}^i c_j(X_j). \]
</p>
<p> The \(c_j\) are some cost (or revenue) function at step \(j\). The objective is to estimate \(\mu=\mathbb E[Y_{\tau}]\), where \(\tau\) is a stopping time (fixed or stochastic). It is possible that \(c_j(\cdot)=0\) for all \(j&lt;\tau\).</p>
<p>The basic class is <a class="el" href="classumontreal_1_1ssj_1_1markovchainrqmc_1_1MarkovChain.html">umontreal.ssj.markovchainrqmc.MarkovChain</a> which contains methods to simulate steps of the Markov chains or several runs and store the performance mesure in a statistical collector. Simulation can be done using Monte Carlo or quasi-Monte Carlo.</p>
<p>To use these methods, one must implement a class inheriting from <a class="el" href="classumontreal_1_1ssj_1_1markovchainrqmc_1_1MarkovChain.html">umontreal.ssj.markovchainrqmc.MarkovChain</a> and implementing its three abstract methods: <a class="el" href="classumontreal_1_1ssj_1_1markovchainrqmc_1_1MarkovChain.html#a990525d6b77bc46c9d750fa6b72c7888">initialState()</a> resets the chain to its initial state \(x_0\); <a class="el" href="classumontreal_1_1ssj_1_1markovchainrqmc_1_1MarkovChain.html#ade92c8975df62aa71028ecaa5f403868">nextStep(stream)</a> advances the chain by one step from the current state using a random stream, it represents function \(\varphi(\cdot)\); <a class="el" href="classumontreal_1_1ssj_1_1markovchainrqmc_1_1MarkovChain.html#a6bdff112ec0bbd28cf1c0b9c0282712d">getPerformance()</a> returns the performance mesure of the chain, the value of \(Y_i\) where \(i\) is the current step.</p>
<p>However, it is recommended to inherit from <a class="el" href="classumontreal_1_1ssj_1_1markovchainrqmc_1_1MarkovChainComparable.html">umontreal.ssj.markovchainrqmc.MarkovChainComparable</a> (if the chains can be sorted) or <a class="el" href="classumontreal_1_1ssj_1_1markovchainrqmc_1_1MarkovChainDouble.html">umontreal.ssj.markovchainrqmc.MarkovChainDouble</a> (special case for one dimensional state) which are subclasses of <a class="el" href="classumontreal_1_1ssj_1_1markovchainrqmc_1_1MarkovChain.html">umontreal.ssj.markovchainrqmc.MarkovChain</a>, rather than directly from this class. Some other methods are then needed. See examples below for more details.</p>
<p>The classes <a class="el" href="classumontreal_1_1ssj_1_1markovchainrqmc_1_1ArrayOfComparableChains.html">umontreal.ssj.markovchainrqmc.ArrayOfComparableChains</a> and <a class="el" href="classumontreal_1_1ssj_1_1markovchainrqmc_1_1ArrayOfDoubleChains.html">umontreal.ssj.markovchainrqmc.ArrayOfDoubleChains</a> can be used to work with multiple Markov chains in parallel. The chains can then be sorted using method <a class="el" href="classumontreal_1_1ssj_1_1markovchainrqmc_1_1ArrayOfComparableChains.html#acc3770a1bd31de8f0989ad6de85cc1b6" title="Sorts the chains using the stored umontreal.ssj.util.MultiDimSort. ">umontreal.ssj.markovchainrqmc.ArrayOfComparableChains.sortChains</a>. These classes also provide methods to simulate using the array-RQMC method of <a class="el" href="citelist.html#CITEREF_vLEC08a">[135]</a>&thinsp;.</p>
<h1>Examples</h1>
<p><a class="anchor" id="REF_markovchainrqmc_overview_sec_examples"></a> The following examples demonstrate how to implement and use a Markov chain using this package.</p>
<p>First, the class displayed in Listing&#160; <a class="el" href="namespaceumontreal_1_1ssj_1_1markovchainrqmc.html#REF_markovchainrqmc_overview_lst_Brownian">Brownian</a> shows a very simple implementation of a <a class="el" href="classumontreal_1_1ssj_1_1markovchainrqmc_1_1MarkovChainComparable.html">umontreal.ssj.markovchainrqmc.MarkovChainComparable</a>. It represents a Brownian motion over the real line. The starting position <code>x0</code> as well as the time step <code>dt</code> are given in the constructor. Each step represents a move which is represented by the addition of a normal variable of mean \(0\) and variance <code>dt</code> to the current position. The performance mesure here is just the positive distance between the current position and the initial position, but it could be anything else.</p>
<p><b>A simple implementation of <code><a class="el" href="classumontreal_1_1ssj_1_1markovchainrqmc_1_1MarkovChainComparable.html" title="A subclass of Markov chain for which there is a total ordering between the states in each dimension i...">MarkovChainComparable</a></code></b> &emsp;[Brownian] <a class="anchor" id="REF_markovchainrqmc_overview_lst_Brownian"></a></p><div class="fragment"><div class="line"><span class="keyword">package </span>markovchainrqmc;</div><div class="line"></div><div class="line"><span class="keyword">import</span> <a class="code" href="namespaceumontreal.html">umontreal</a>.<a class="code" href="namespaceumontreal_1_1ssj.html">ssj</a>.<a class="code" href="namespaceumontreal_1_1ssj_1_1markovchainrqmc.html">markovchainrqmc</a>.<a class="code" href="classumontreal_1_1ssj_1_1markovchainrqmc_1_1MarkovChainComparable.html">MarkovChainComparable</a>;</div><div class="line"><span class="keyword">import</span> <a class="code" href="namespaceumontreal.html">umontreal</a>.<a class="code" href="namespaceumontreal_1_1ssj.html">ssj</a>.<a class="code" href="namespaceumontreal_1_1ssj_1_1rng.html">rng</a>.<a class="code" href="interfaceumontreal_1_1ssj_1_1rng_1_1RandomStream.html">RandomStream</a>;</div><div class="line"><span class="keyword">import</span> <a class="code" href="namespaceumontreal.html">umontreal</a>.<a class="code" href="namespaceumontreal_1_1ssj.html">ssj</a>.<a class="code" href="namespaceumontreal_1_1ssj_1_1probdist.html">probdist</a>.<a class="code" href="classumontreal_1_1ssj_1_1probdist_1_1NormalDist.html">NormalDist</a>;</div><div class="line"></div><div class="line"><span class="keyword">class </span>Brownian <span class="keyword">extends</span> MarkovChainComparable  {</div><div class="line">   <span class="keyword">final</span> <span class="keywordtype">double</span> x0;                   <span class="comment">// Initial position.</span></div><div class="line">   <span class="keyword">final</span> <span class="keywordtype">double</span> dt, sqrtDt;           <span class="comment">// Time interval between observations.</span></div><div class="line">   <span class="keywordtype">double</span> x;                           <span class="comment">// Position.              </span></div><div class="line"></div><div class="line">   <span class="keyword">public</span> Brownian (<span class="keywordtype">double</span> x0, <span class="keywordtype">double</span> dt) {</div><div class="line">       this.x0 = x0;</div><div class="line">       this.dt = dt;</div><div class="line">       <span class="keywordflow">if</span> (dt &lt; 0)</div><div class="line">          <span class="keywordflow">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="stringliteral">&quot;dt must be positive&quot;</span>);</div><div class="line">       sqrtDt = Math.sqrt (dt);        <span class="comment">// Just for faster computation</span></div><div class="line">       stateDim = 1;                   <span class="comment">// Dimension of state.</span></div><div class="line">       initialState();</div><div class="line">   }</div><div class="line"></div><div class="line">   <span class="comment">// Sets initial position</span></div><div class="line">   <span class="keyword">public</span> <span class="keywordtype">void</span> initialState () {</div><div class="line">      x = x0;                          </div><div class="line">   }</div><div class="line"></div><div class="line">   <span class="comment">// Simulates the next step.</span></div><div class="line">   <span class="keyword">public</span> <span class="keywordtype">void</span> nextStep (RandomStream stream) {</div><div class="line">      x += sqrtDt * NormalDist.inverseF01 (stream.nextDouble());  </div><div class="line">   }</div><div class="line"></div><div class="line">   <span class="comment">// Returns performance mesure.</span></div><div class="line">   <span class="keyword">public</span> <span class="keywordtype">double</span> getPerformance () {</div><div class="line">      <span class="keywordflow">return</span> Math.abs(x-x0);</div><div class="line">   }</div><div class="line">   </div><div class="line">   <span class="comment">// Compares value of x between two chains.</span></div><div class="line">   <span class="keyword">public</span> <span class="keywordtype">int</span> compareTo (MarkovChainComparable m, <span class="keywordtype">int</span> i) {</div><div class="line">      <span class="keywordflow">if</span> (!(m instanceof Brownian))     </div><div class="line">         <span class="keywordflow">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="stringliteral">&quot;Can&#39;t compare a &quot;</span> +</div><div class="line">           <span class="stringliteral">&quot;Brownian Markov chain with other types of Markov chains.&quot;</span>); </div><div class="line">      <span class="keywordflow">switch</span>(i) {</div><div class="line">         <span class="keywordflow">case</span> 0: </div><div class="line">            <span class="keywordtype">double</span> mx = ((Brownian)m).x;</div><div class="line">            <span class="keywordflow">return</span> (x&gt;mx ? 1 : (x&lt;mx ? -1 : 0));</div><div class="line">         <span class="keywordflow">default</span>: </div><div class="line">            <span class="keywordflow">throw</span> <span class="keyword">new</span> AssertionError(<span class="stringliteral">&quot;Invalid state index&quot;</span> );</div><div class="line">      }</div><div class="line">   }</div><div class="line">}</div></div><!-- fragment --><p>The program displayed in Listing&#160; <a class="el" href="namespaceumontreal_1_1ssj_1_1markovchainrqmc.html#REF_markovchainrqmc_overview_lst_BrownianTest">BrownianTest</a> shows different ways to use the Markov chain.</p>
<p>1- How to simulate the trajectory and print the state of the chain at each step and the performance at the end.</p>
<p>2- How to simulate using Monte Carlo to get an unbiased estimator of the expectation of the performance and an estimation of its variance. If stream is a <a class="el" href="interfaceumontreal_1_1ssj_1_1hups_1_1PointSetIterator.html">umontreal.ssj.hups.PointSetIterator</a>, use <a class="el" href="classumontreal_1_1ssj_1_1markovchainrqmc_1_1MarkovChain.html#ab31d2095da675698cbda3c7cc88c35d0" title="Same as simulRuns, except that the stream is first reset to its initial seed and then reset to the fi...">umontreal.ssj.markovchainrqmc.MarkovChain.simulRunsWithSubstreams</a> instead of <a class="el" href="classumontreal_1_1ssj_1_1markovchainrqmc_1_1MarkovChain.html#a6a865c73948a64501649695f064496b8" title="Performs n simulation runs of the chain, for numSteps steps per run, using the given stream...">umontreal.ssj.markovchainrqmc.MarkovChain.simulRuns</a>. The <a class="el" href="classumontreal_1_1ssj_1_1stat_1_1Tally.html">umontreal.ssj.stat.Tally</a> is a statistical collector; see package <code><a class="el" href="namespaceumontreal_1_1ssj_1_1stat.html" title="Tools for Collecting Statistics. ">umontreal.ssj.stat</a></code> for how to use it.</p>
<p>3- Same as 2 but with randomized quasi-Monte Carlo. Basically, it takes a <a class="el" href="classumontreal_1_1ssj_1_1hups_1_1PointSet.html">umontreal.ssj.hups.PointSet</a> where the dimension of the points is the number of steps and the number of points is the number of trajectories. The <a class="el" href="interfaceumontreal_1_1ssj_1_1hups_1_1PointSetRandomization.html">umontreal.ssj.hups.PointSetRandomization</a> must be compatible with the point set. See package <code><a class="el" href="namespaceumontreal_1_1ssj_1_1hups.html" title="Highly Uniform Point Sets. ">umontreal.ssj.hups</a></code> more information on these classes.</p>
<p>4- Same as 2 but with the array-RQMC method (see <a class="el" href="citelist.html#CITEREF_vLEC05a">[136]</a>&thinsp;). The <a class="el" href="classumontreal_1_1ssj_1_1markovchainrqmc_1_1ArrayOfComparableChains.html">umontreal.ssj.markovchainrqmc.ArrayOfComparableChains</a> is used to simulate chains in parallel. It uses a <a class="el" href="interfaceumontreal_1_1ssj_1_1hups_1_1PointSetRandomization.html">umontreal.ssj.hups.PointSetRandomization</a> to randomize the point sets and a umontreal.ssj.util.MultiDimSort to sort the chains. Here, as the chain is one-dimensional, the sort used is a umontreal.ssj.util.OneDimSort. It is important to call <a class="el" href="classumontreal_1_1ssj_1_1markovchainrqmc_1_1ArrayOfComparableChains.html#a09c89a71ce5be772a282dd0aa9607050" title="Creates n copies (clones) of the chain baseChain and puts them in an array, ready for the array RQMC ...">umontreal.ssj.markovchainrqmc.ArrayOfComparableChains.makeCopies(int)</a> in order to set the number of chains. See package <code><a class="el" href="namespaceumontreal_1_1ssj_1_1util.html" title="General basic utilities. ">umontreal.ssj.util</a></code> for more information on sorts.</p>
<p>5- How to simulate the trajectories with array-RQMC and do something with the chains at each step. The <code>Do something with mc</code> comment should be replaced by anything, using the <a class="el" href="classumontreal_1_1ssj_1_1markovchainrqmc_1_1MarkovChain.html">umontreal.ssj.markovchainrqmc.MarkovChain</a> <code>mc</code>. For example to store or print the state <code>x</code> of each chain for a later use.</p>
<p><b>Tests using a <code><a class="el" href="classumontreal_1_1ssj_1_1markovchainrqmc_1_1MarkovChainComparable.html" title="A subclass of Markov chain for which there is a total ordering between the states in each dimension i...">MarkovChainComparable</a></code></b> &emsp;[BrownianTest] <a class="anchor" id="REF_markovchainrqmc_overview_lst_BrownianTest"></a></p><div class="fragment"><div class="line"><span class="keyword">package </span>markovchainrqmc;</div><div class="line"></div><div class="line"><span class="keyword">import</span> <a class="code" href="namespaceumontreal.html">umontreal</a>.<a class="code" href="namespaceumontreal_1_1ssj.html">ssj</a>.<a class="code" href="namespaceumontreal_1_1ssj_1_1markovchainrqmc.html">markovchainrqmc</a>.*;</div><div class="line"><span class="keyword">import</span> <a class="code" href="namespaceumontreal.html">umontreal</a>.<a class="code" href="namespaceumontreal_1_1ssj.html">ssj</a>.<a class="code" href="namespaceumontreal_1_1ssj_1_1hups.html">hups</a>.*;</div><div class="line"><span class="keyword">import</span> <a class="code" href="namespaceumontreal.html">umontreal</a>.<a class="code" href="namespaceumontreal_1_1ssj.html">ssj</a>.<a class="code" href="namespaceumontreal_1_1ssj_1_1rng.html">rng</a>.*;</div><div class="line"><span class="keyword">import</span> <a class="code" href="namespaceumontreal.html">umontreal</a>.<a class="code" href="namespaceumontreal_1_1ssj.html">ssj</a>.<a class="code" href="namespaceumontreal_1_1ssj_1_1stat.html">stat</a>.<a class="code" href="classumontreal_1_1ssj_1_1stat_1_1Tally.html">Tally</a>;</div><div class="line"><span class="keyword">import</span> <a class="code" href="namespaceumontreal.html">umontreal</a>.<a class="code" href="namespaceumontreal_1_1ssj.html">ssj</a>.<a class="code" href="namespaceumontreal_1_1ssj_1_1util.html">util</a>.*;</div><div class="line"><span class="keyword">import</span> <a class="code" href="namespaceumontreal.html">umontreal</a>.<a class="code" href="namespaceumontreal_1_1ssj.html">ssj</a>.<a class="code" href="namespaceumontreal_1_1ssj_1_1util.html">util</a>.<a class="code" href="namespaceumontreal_1_1ssj_1_1util_1_1sort.html">sort</a>.*;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="keyword">class </span>BrownianTest {</div><div class="line">   Brownian brownian;</div><div class="line">   </div><div class="line">   <span class="keyword">public</span> BrownianTest (<span class="keywordtype">double</span> x0, <span class="keywordtype">double</span> dt) {</div><div class="line">      brownian = <span class="keyword">new</span> Brownian(x0,dt);</div><div class="line">      tests();</div><div class="line">   }</div><div class="line">   </div><div class="line">   <span class="keyword">public</span> <span class="keywordtype">void</span> tests() {</div><div class="line">      RandomStream stream = <span class="keyword">new</span> MRG32k3a();</div><div class="line">      </div><div class="line">      <span class="comment">//1- Print trajectory and performance for 20 steps of the chain.</span></div><div class="line">      System.out.println(<span class="stringliteral">&quot;1- Print trajectory and performance&quot;</span>);</div><div class="line">      brownian.initialState ();</div><div class="line">      System.out.println(<span class="stringliteral">&quot;step =  0,   position =  &quot;</span> + brownian.x);</div><div class="line">      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> step = 1; step &lt; 21; ++step){</div><div class="line">          brownian.nextStep (stream);</div><div class="line">          System.out.printf(<span class="stringliteral">&quot;step = %2d,   position = %8.5f%n&quot;</span>, step, brownian.x);</div><div class="line">      }</div><div class="line">      System.out.printf(<span class="stringliteral">&quot;Performance = %8.5f%n&quot;</span>, brownian.getPerformance());</div><div class="line">      </div><div class="line">      <span class="comment">//2- Monte Carlo, 100 replications, 2^12 trajectories, 20 steps </span></div><div class="line">      Tally performance = <span class="keyword">new</span> Tally(<span class="stringliteral">&quot;Performance of Brownian Motion&quot;</span>);</div><div class="line">      Tally replicates = <span class="keyword">new</span> Tally(<span class="stringliteral">&quot;Replicates of Brownian Motion&quot;</span>);</div><div class="line">      <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i=0; i&lt;100; ++i){</div><div class="line">         brownian.simulRuns(4096,20,stream,performance);</div><div class="line">         stream.resetNextSubstream();</div><div class="line">         replicates.add(performance.average());</div><div class="line">      }</div><div class="line">      System.out.println(<span class="stringliteral">&quot;\n 2- MC, 100 reps, 2^12 trajetories, 20 steps &quot;</span>);</div><div class="line">      System.out.println(replicates.report());</div><div class="line">      </div><div class="line">      <span class="comment">//3- RQMC, 100 replications, 2^12 trajectories, 20 steps </span></div><div class="line">      PointSetRandomization rand = <span class="keyword">new</span> RandomShift(stream);</div><div class="line">      PointSet p = <span class="keyword">new</span> SobolSequence(12,31,20);</div><div class="line">      brownian.simulRQMC(p,100,20,rand,replicates);</div><div class="line">      System.out.println(<span class="stringliteral">&quot;\n 3- RQMC, 100 reps, 2^12 trajectories, 20 steps&quot;</span>);</div><div class="line">      System.out.println(replicates.report());</div><div class="line">      </div><div class="line">      <span class="comment">//4- Array-RQMC, 100 replications, 2^12 trajectories, 20 steps</span></div><div class="line">      PointSet p2 = <span class="keyword">new</span> SobolSequence(12,31,1);</div><div class="line">      MultiDimSort sort = <span class="keyword">new</span> OneDimSort(0);</div><div class="line">      ArrayOfComparableChains array = </div><div class="line">                              <span class="keyword">new</span> ArrayOfComparableChains(brownian, rand, sort);</div><div class="line">      array.makeCopies(4096);</div><div class="line">      array.simulReplicatesArrayRQMC (p2, rand, sort, 0, 100, 20, replicates);</div><div class="line">      System.out.println(<span class="stringliteral">&quot;\n 4- Array-RQMC, 100 replications&quot;</span> + </div><div class="line">                                              <span class="stringliteral">&quot;, 2^12 trajectories, 20 steps&quot;</span>);</div><div class="line">      System.out.println(replicates.report());</div><div class="line">      </div><div class="line">      <span class="comment">//5- Array-RQMC Simulate and use 2^12 trajectories, 20 steps </span></div><div class="line">      array.makeCopies(4096);</div><div class="line">      array.initialStates();</div><div class="line">      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> step = 1; step &lt; 21; ++step){</div><div class="line">          array.sortChains();</div><div class="line">          array.simulOneStepArrayRQMC (p2);</div><div class="line">          <span class="keywordflow">for</span>(MarkovChainComparable mc: array.getChains()){</div><div class="line">             <span class="comment">//Do something with mc</span></div><div class="line">          }</div><div class="line">      }</div><div class="line">   }</div><div class="line"></div><div class="line">   <span class="keyword">public</span> <span class="keyword">static</span> <span class="keywordtype">void</span> main (String[] args) {</div><div class="line">      <span class="keywordtype">double</span> x0 = 0.0;</div><div class="line">      <span class="keywordtype">double</span> dt = 0.1;       </div><div class="line">      BrownianTest testBrownian = <span class="keyword">new</span> BrownianTest(x0,dt);</div><div class="line">   }</div><div class="line">}</div></div><!-- fragment --><p>The output of this program is displayed in Listing&#160; <a class="el" href="namespaceumontreal_1_1ssj_1_1markovchainrqmc.html#REF_markovchainrqmc_overview_lst_BrownianTestOutput">BrownianTestOutput</a>. For this example, the variance of the estimator with RQMC is 6.25 times less than MC, and 388 times less with array-RQMC compared to MC.</p>
<p><b>Output of BrownianTest.java</b> &emsp;[BrownianTestOutput] <a class="anchor" id="REF_markovchainrqmc_overview_lst_BrownianTestOutput"></a></p><div class="fragment"><div class="line">1- Print trajectory and performance</div><div class="line">step =  0,   position =  0.0</div><div class="line">step =  1,   position = -0.36070</div><div class="line">step =  2,   position = -0.50990</div><div class="line">step =  3,   position = -0.66743</div><div class="line">step =  4,   position = -0.37085</div><div class="line">step =  5,   position = -0.61330</div><div class="line">step =  6,   position = -0.58680</div><div class="line">step =  7,   position = -0.60205</div><div class="line">step =  8,   position = -0.71916</div><div class="line">step =  9,   position = -1.06654</div><div class="line">step = 10,   position = -0.84739</div><div class="line">step = 11,   position = -0.78714</div><div class="line">step = 12,   position = -0.85904</div><div class="line">step = 13,   position = -1.00137</div><div class="line">step = 14,   position = -1.22434</div><div class="line">step = 15,   position = -1.13596</div><div class="line">step = 16,   position = -0.72304</div><div class="line">step = 17,   position = -0.88980</div><div class="line">step = 18,   position = -1.46628</div><div class="line">step = 19,   position = -0.88737</div><div class="line">step = 20,   position = -1.22407</div><div class="line">Performance =  1.22407</div><div class="line"></div><div class="line"> 2- MC, 100 reps, 2^12 trajetories, 20 steps </div><div class="line">REPORT on Tally stat. collector ==&gt; Replicates of Brownian Motion</div><div class="line">    num. obs.     min         max       average    standard dev.</div><div class="line">       100       1.098       1.166       1.130       0.013</div><div class="line"></div><div class="line"></div><div class="line"> 3- RQMC, 100 reps, 2^12 trajectories, 20 steps</div><div class="line">REPORT on Tally stat. collector ==&gt; Replicates of Brownian Motion</div><div class="line">    num. obs.     min         max       average    standard dev.</div><div class="line">       100       1.115       1.140       1.127      5.2E-3</div><div class="line"></div><div class="line"></div><div class="line"> 4- Array-RQMC, 100 replications, 2^12 trajectories, 20 steps</div><div class="line">REPORT on Tally stat. collector ==&gt; Replicates of Brownian Motion</div><div class="line">    num. obs.     min         max       average    standard dev.</div><div class="line">       100       1.126       1.130       1.128      6.6E-4</div><div class="line"></div></div><!-- fragment --><p><a class="anchor" id="REF_markovchainrqmc_overview_sec_overview"></a> This package provides facilities designed specifically to simulate discrete-time Markov chains (DTMC) with the Array-RQMC method. With this method, several realizations of the Markov chain are simulated in parallel. At each step, the chains are sorted (in some way) based on the value of their current state, then all the chains are simulated for one more step using an RQMC point set. We now give more details on the setting.</p>
<p>A DTMC can be written as \(\{X_i, i\in I\}\) where \(I=\{0,1,2,â€¦\}\), \(X_i \in \mathcal{S}\) represents the state at step \(i\), and the state space \(\mathcal{S}\) is arbitrary. Typically, \(\mathcal{S} \subseteq \mathbb{R}^\ell\) for some \(\ell\geq 1\). We assume that the state evolves according to the stochastic recurrence </p><p class="formulaDsp">
\[ X_0 = x_0, \qquad\mbox{ and } X_j = \varphi(X_{j-1},\mathbf{U}_j) \mbox{ for } j\ge 1, \]
</p>
<p> where the \(\mathbf{U}_j\) are independent random variables uniformly distributed over \([0,1)^d\) for some integer \(d \geq 1\) (it is often 1, but can be larger). A performance mesure \(Y_\tau\) is defined over this sequence as </p><p class="formulaDsp">
\[ Y_\tau = \sum_{j=1}^\tau c_j(X_j), \]
</p>
<p> where \(c_j\) is a cost (or revenue) function for step \(j\) and \(\tau\) is either a constant of a random stopping time. Often, \(c_j\) does not depend on \(j\). The goal is to estimate \(\mu=\mathbb E[Y_{\tau}]\). It is not rare that \(c_j(\cdot)=0\) for all \(j&lt;\tau\), i.e., that the cost or revenue occurs only at the end.</p>
<p>The base class <a class="el" href="classumontreal_1_1ssj_1_1markovchainrqmc_1_1MarkovChain.html">umontreal.ssj.markovchainrqmc.MarkovChain</a> offers methods to simulate one or more copies of the Markov chain one step at a time, or over several steps, collect the realizations of $Y_$ in statistical probes, make several independent replications of that, etc. The chains can be simulated by Monte Carlo, RQMC, or Array-RQMC.</p>
<p>To use these tools, one must define a subclass of <a class="el" href="classumontreal_1_1ssj_1_1markovchainrqmc_1_1MarkovChain.html">umontreal.ssj.markovchainrqmc.MarkovChain</a> and implement its three abstract methods: <a class="el" href="classumontreal_1_1ssj_1_1markovchainrqmc_1_1MarkovChain.html#a990525d6b77bc46c9d750fa6b72c7888">initialState()</a> which resets the chain to its initial state \(x_0\); <a class="el" href="classumontreal_1_1ssj_1_1markovchainrqmc_1_1MarkovChain.html#ade92c8975df62aa71028ecaa5f403868">nextStep(stream)</a> which advances the chain by one step from the current state using a random stream (it represents function \(\varphi(\cdot)\)); and <a class="el" href="classumontreal_1_1ssj_1_1markovchainrqmc_1_1MarkovChain.html#a6bdff112ec0bbd28cf1c0b9c0282712d">getPerformance()</a> which returns the performance realization for the chain, i.e., the value taken by \(Y_\tau\).</p>
<p>However, it is recommended to inherit from <a class="el" href="classumontreal_1_1ssj_1_1markovchainrqmc_1_1MarkovChainComparable.html">umontreal.ssj.markovchainrqmc.MarkovChainComparable</a> (if the chains can be sorted) or <a class="el" href="classumontreal_1_1ssj_1_1markovchainrqmc_1_1MarkovChainDouble.html">umontreal.ssj.markovchainrqmc.MarkovChainDouble</a> (special case for one dimensional state) which are subclasses of <a class="el" href="classumontreal_1_1ssj_1_1markovchainrqmc_1_1MarkovChain.html">umontreal.ssj.markovchainrqmc.MarkovChain</a>, rather than directly from this class. Some other methods are then needed. See examples below for more details.</p>
<p>The classes <a class="el" href="classumontreal_1_1ssj_1_1markovchainrqmc_1_1ArrayOfComparableChains.html">umontreal.ssj.markovchainrqmc.ArrayOfComparableChains</a> and <a class="el" href="classumontreal_1_1ssj_1_1markovchainrqmc_1_1ArrayOfDoubleChains.html">umontreal.ssj.markovchainrqmc.ArrayOfDoubleChains</a> can be used to work with multiple Markov chains in parallel. The chains can then be sorted using method <a class="el" href="classumontreal_1_1ssj_1_1markovchainrqmc_1_1ArrayOfComparableChains.html#acc3770a1bd31de8f0989ad6de85cc1b6" title="Sorts the chains using the stored umontreal.ssj.util.MultiDimSort. ">umontreal.ssj.markovchainrqmc.ArrayOfComparableChains.sortChains</a>. These classes also provide methods to simulate using the array-RQMC method of <a class="el" href="citelist.html#CITEREF_vLEC08a">[135]</a>&thinsp;.</p>
<h1>Examples</h1>
<p><a class="anchor" id="REF_markovchainrqmc_overview_sec_examples"></a> The following examples demonstrate how to implement and use a Markov chain using this package.</p>
<p>First, the class displayed in Listing&#160; <a class="el" href="namespaceumontreal_1_1ssj_1_1markovchainrqmc.html#REF_markovchainrqmc_overview_lst_Brownian">Brownian</a> shows a very simple implementation of a <a class="el" href="classumontreal_1_1ssj_1_1markovchainrqmc_1_1MarkovChainComparable.html">umontreal.ssj.markovchainrqmc.MarkovChainComparable</a>. It represents a Brownian motion over the real line. The starting position <code>x0</code> as well as the time step <code>dt</code> are given in the constructor. Each step represents a move which is represented by the addition of a normal variable of mean \(0\) and variance <code>dt</code> to the current position. The performance mesure here is just the positive distance between the current position and the initial position, but it could be anything else.</p>
<p><b>A simple implementation of <code><a class="el" href="classumontreal_1_1ssj_1_1markovchainrqmc_1_1MarkovChainComparable.html" title="A subclass of Markov chain for which there is a total ordering between the states in each dimension i...">MarkovChainComparable</a></code></b> &emsp;[Brownian] <a class="anchor" id="REF_markovchainrqmc_overview_lst_Brownian"></a></p><div class="fragment"><div class="line"><span class="keyword">package </span>markovchainrqmc;</div><div class="line"></div><div class="line"><span class="keyword">import</span> <a class="code" href="namespaceumontreal.html">umontreal</a>.<a class="code" href="namespaceumontreal_1_1ssj.html">ssj</a>.<a class="code" href="namespaceumontreal_1_1ssj_1_1markovchainrqmc.html">markovchainrqmc</a>.<a class="code" href="classumontreal_1_1ssj_1_1markovchainrqmc_1_1MarkovChainComparable.html">MarkovChainComparable</a>;</div><div class="line"><span class="keyword">import</span> <a class="code" href="namespaceumontreal.html">umontreal</a>.<a class="code" href="namespaceumontreal_1_1ssj.html">ssj</a>.<a class="code" href="namespaceumontreal_1_1ssj_1_1rng.html">rng</a>.<a class="code" href="interfaceumontreal_1_1ssj_1_1rng_1_1RandomStream.html">RandomStream</a>;</div><div class="line"><span class="keyword">import</span> <a class="code" href="namespaceumontreal.html">umontreal</a>.<a class="code" href="namespaceumontreal_1_1ssj.html">ssj</a>.<a class="code" href="namespaceumontreal_1_1ssj_1_1probdist.html">probdist</a>.<a class="code" href="classumontreal_1_1ssj_1_1probdist_1_1NormalDist.html">NormalDist</a>;</div><div class="line"></div><div class="line"><span class="keyword">class </span>Brownian <span class="keyword">extends</span> MarkovChainComparable  {</div><div class="line">   <span class="keyword">final</span> <span class="keywordtype">double</span> x0;                   <span class="comment">// Initial position.</span></div><div class="line">   <span class="keyword">final</span> <span class="keywordtype">double</span> dt, sqrtDt;           <span class="comment">// Time interval between observations.</span></div><div class="line">   <span class="keywordtype">double</span> x;                           <span class="comment">// Position.              </span></div><div class="line"></div><div class="line">   <span class="keyword">public</span> Brownian (<span class="keywordtype">double</span> x0, <span class="keywordtype">double</span> dt) {</div><div class="line">       this.x0 = x0;</div><div class="line">       this.dt = dt;</div><div class="line">       <span class="keywordflow">if</span> (dt &lt; 0)</div><div class="line">          <span class="keywordflow">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="stringliteral">&quot;dt must be positive&quot;</span>);</div><div class="line">       sqrtDt = Math.sqrt (dt);        <span class="comment">// Just for faster computation</span></div><div class="line">       stateDim = 1;                   <span class="comment">// Dimension of state.</span></div><div class="line">       initialState();</div><div class="line">   }</div><div class="line"></div><div class="line">   <span class="comment">// Sets initial position</span></div><div class="line">   <span class="keyword">public</span> <span class="keywordtype">void</span> initialState () {</div><div class="line">      x = x0;                          </div><div class="line">   }</div><div class="line"></div><div class="line">   <span class="comment">// Simulates the next step.</span></div><div class="line">   <span class="keyword">public</span> <span class="keywordtype">void</span> nextStep (RandomStream stream) {</div><div class="line">      x += sqrtDt * NormalDist.inverseF01 (stream.nextDouble());  </div><div class="line">   }</div><div class="line"></div><div class="line">   <span class="comment">// Returns performance mesure.</span></div><div class="line">   <span class="keyword">public</span> <span class="keywordtype">double</span> getPerformance () {</div><div class="line">      <span class="keywordflow">return</span> Math.abs(x-x0);</div><div class="line">   }</div><div class="line">   </div><div class="line">   <span class="comment">// Compares value of x between two chains.</span></div><div class="line">   <span class="keyword">public</span> <span class="keywordtype">int</span> compareTo (MarkovChainComparable m, <span class="keywordtype">int</span> i) {</div><div class="line">      <span class="keywordflow">if</span> (!(m instanceof Brownian))     </div><div class="line">         <span class="keywordflow">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="stringliteral">&quot;Can&#39;t compare a &quot;</span> +</div><div class="line">           <span class="stringliteral">&quot;Brownian Markov chain with other types of Markov chains.&quot;</span>); </div><div class="line">      <span class="keywordflow">switch</span>(i) {</div><div class="line">         <span class="keywordflow">case</span> 0: </div><div class="line">            <span class="keywordtype">double</span> mx = ((Brownian)m).x;</div><div class="line">            <span class="keywordflow">return</span> (x&gt;mx ? 1 : (x&lt;mx ? -1 : 0));</div><div class="line">         <span class="keywordflow">default</span>: </div><div class="line">            <span class="keywordflow">throw</span> <span class="keyword">new</span> AssertionError(<span class="stringliteral">&quot;Invalid state index&quot;</span> );</div><div class="line">      }</div><div class="line">   }</div><div class="line">}</div></div><!-- fragment --><p>The program displayed in Listing&#160; <a class="el" href="namespaceumontreal_1_1ssj_1_1markovchainrqmc.html#REF_markovchainrqmc_overview_lst_BrownianTest">BrownianTest</a> shows different ways to use the Markov chain.</p>
<p>1- How to simulate the trajectory and print the state of the chain at each step and the performance at the end.</p>
<p>2- How to simulate using Monte Carlo to get an unbiased estimator of the expectation of the performance and an estimation of its variance. If stream is a <a class="el" href="interfaceumontreal_1_1ssj_1_1hups_1_1PointSetIterator.html">umontreal.ssj.hups.PointSetIterator</a>, use <a class="el" href="classumontreal_1_1ssj_1_1markovchainrqmc_1_1MarkovChain.html#ab31d2095da675698cbda3c7cc88c35d0" title="Same as simulRuns, except that the stream is first reset to its initial seed and then reset to the fi...">umontreal.ssj.markovchainrqmc.MarkovChain.simulRunsWithSubstreams</a> instead of <a class="el" href="classumontreal_1_1ssj_1_1markovchainrqmc_1_1MarkovChain.html#a6a865c73948a64501649695f064496b8" title="Performs n simulation runs of the chain, for numSteps steps per run, using the given stream...">umontreal.ssj.markovchainrqmc.MarkovChain.simulRuns</a>. The <a class="el" href="classumontreal_1_1ssj_1_1stat_1_1Tally.html">umontreal.ssj.stat.Tally</a> is a statistical collector; see package <code><a class="el" href="namespaceumontreal_1_1ssj_1_1stat.html" title="Tools for Collecting Statistics. ">umontreal.ssj.stat</a></code> for how to use it.</p>
<p>3- Same as 2 but with randomized quasi-Monte Carlo. Basically, it takes a <a class="el" href="classumontreal_1_1ssj_1_1hups_1_1PointSet.html">umontreal.ssj.hups.PointSet</a> where the dimension of the points is the number of steps and the number of points is the number of trajectories. The <a class="el" href="interfaceumontreal_1_1ssj_1_1hups_1_1PointSetRandomization.html">umontreal.ssj.hups.PointSetRandomization</a> must be compatible with the point set. See package <code><a class="el" href="namespaceumontreal_1_1ssj_1_1hups.html" title="Highly Uniform Point Sets. ">umontreal.ssj.hups</a></code> more information on these classes.</p>
<p>4- Same as 2 but with the array-RQMC method (see <a class="el" href="citelist.html#CITEREF_vLEC05a">[136]</a>&thinsp;). The <a class="el" href="classumontreal_1_1ssj_1_1markovchainrqmc_1_1ArrayOfComparableChains.html">umontreal.ssj.markovchainrqmc.ArrayOfComparableChains</a> is used to simulate chains in parallel. It uses a <a class="el" href="interfaceumontreal_1_1ssj_1_1hups_1_1PointSetRandomization.html">umontreal.ssj.hups.PointSetRandomization</a> to randomize the point sets and a umontreal.ssj.util.MultiDimSort to sort the chains. Here, as the chain is one-dimensional, the sort used is a umontreal.ssj.util.OneDimSort. It is important to call <a class="el" href="classumontreal_1_1ssj_1_1markovchainrqmc_1_1ArrayOfComparableChains.html#a09c89a71ce5be772a282dd0aa9607050" title="Creates n copies (clones) of the chain baseChain and puts them in an array, ready for the array RQMC ...">umontreal.ssj.markovchainrqmc.ArrayOfComparableChains.makeCopies(int)</a> in order to set the number of chains. See package <code><a class="el" href="namespaceumontreal_1_1ssj_1_1util.html" title="General basic utilities. ">umontreal.ssj.util</a></code> for more information on sorts.</p>
<p>5- How to simulate the trajectories with array-RQMC and do something with the chains at each step. The <code>Do something with mc</code> comment should be replaced by anything, using the <a class="el" href="classumontreal_1_1ssj_1_1markovchainrqmc_1_1MarkovChain.html">umontreal.ssj.markovchainrqmc.MarkovChain</a> <code>mc</code>. For example to store or print the state <code>x</code> of each chain for a later use.</p>
<p><b>Tests using a <code><a class="el" href="classumontreal_1_1ssj_1_1markovchainrqmc_1_1MarkovChainComparable.html" title="A subclass of Markov chain for which there is a total ordering between the states in each dimension i...">MarkovChainComparable</a></code></b> &emsp;[BrownianTest] <a class="anchor" id="REF_markovchainrqmc_overview_lst_BrownianTest"></a></p><div class="fragment"><div class="line"><span class="keyword">package </span>markovchainrqmc;</div><div class="line"></div><div class="line"><span class="keyword">import</span> <a class="code" href="namespaceumontreal.html">umontreal</a>.<a class="code" href="namespaceumontreal_1_1ssj.html">ssj</a>.<a class="code" href="namespaceumontreal_1_1ssj_1_1markovchainrqmc.html">markovchainrqmc</a>.*;</div><div class="line"><span class="keyword">import</span> <a class="code" href="namespaceumontreal.html">umontreal</a>.<a class="code" href="namespaceumontreal_1_1ssj.html">ssj</a>.<a class="code" href="namespaceumontreal_1_1ssj_1_1hups.html">hups</a>.*;</div><div class="line"><span class="keyword">import</span> <a class="code" href="namespaceumontreal.html">umontreal</a>.<a class="code" href="namespaceumontreal_1_1ssj.html">ssj</a>.<a class="code" href="namespaceumontreal_1_1ssj_1_1rng.html">rng</a>.*;</div><div class="line"><span class="keyword">import</span> <a class="code" href="namespaceumontreal.html">umontreal</a>.<a class="code" href="namespaceumontreal_1_1ssj.html">ssj</a>.<a class="code" href="namespaceumontreal_1_1ssj_1_1stat.html">stat</a>.<a class="code" href="classumontreal_1_1ssj_1_1stat_1_1Tally.html">Tally</a>;</div><div class="line"><span class="keyword">import</span> <a class="code" href="namespaceumontreal.html">umontreal</a>.<a class="code" href="namespaceumontreal_1_1ssj.html">ssj</a>.<a class="code" href="namespaceumontreal_1_1ssj_1_1util.html">util</a>.*;</div><div class="line"><span class="keyword">import</span> <a class="code" href="namespaceumontreal.html">umontreal</a>.<a class="code" href="namespaceumontreal_1_1ssj.html">ssj</a>.<a class="code" href="namespaceumontreal_1_1ssj_1_1util.html">util</a>.<a class="code" href="namespaceumontreal_1_1ssj_1_1util_1_1sort.html">sort</a>.*;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="keyword">class </span>BrownianTest {</div><div class="line">   Brownian brownian;</div><div class="line">   </div><div class="line">   <span class="keyword">public</span> BrownianTest (<span class="keywordtype">double</span> x0, <span class="keywordtype">double</span> dt) {</div><div class="line">      brownian = <span class="keyword">new</span> Brownian(x0,dt);</div><div class="line">      tests();</div><div class="line">   }</div><div class="line">   </div><div class="line">   <span class="keyword">public</span> <span class="keywordtype">void</span> tests() {</div><div class="line">      RandomStream stream = <span class="keyword">new</span> MRG32k3a();</div><div class="line">      </div><div class="line">      <span class="comment">//1- Print trajectory and performance for 20 steps of the chain.</span></div><div class="line">      System.out.println(<span class="stringliteral">&quot;1- Print trajectory and performance&quot;</span>);</div><div class="line">      brownian.initialState ();</div><div class="line">      System.out.println(<span class="stringliteral">&quot;step =  0,   position =  &quot;</span> + brownian.x);</div><div class="line">      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> step = 1; step &lt; 21; ++step){</div><div class="line">          brownian.nextStep (stream);</div><div class="line">          System.out.printf(<span class="stringliteral">&quot;step = %2d,   position = %8.5f%n&quot;</span>, step, brownian.x);</div><div class="line">      }</div><div class="line">      System.out.printf(<span class="stringliteral">&quot;Performance = %8.5f%n&quot;</span>, brownian.getPerformance());</div><div class="line">      </div><div class="line">      <span class="comment">//2- Monte Carlo, 100 replications, 2^12 trajectories, 20 steps </span></div><div class="line">      Tally performance = <span class="keyword">new</span> Tally(<span class="stringliteral">&quot;Performance of Brownian Motion&quot;</span>);</div><div class="line">      Tally replicates = <span class="keyword">new</span> Tally(<span class="stringliteral">&quot;Replicates of Brownian Motion&quot;</span>);</div><div class="line">      <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i=0; i&lt;100; ++i){</div><div class="line">         brownian.simulRuns(4096,20,stream,performance);</div><div class="line">         stream.resetNextSubstream();</div><div class="line">         replicates.add(performance.average());</div><div class="line">      }</div><div class="line">      System.out.println(<span class="stringliteral">&quot;\n 2- MC, 100 reps, 2^12 trajetories, 20 steps &quot;</span>);</div><div class="line">      System.out.println(replicates.report());</div><div class="line">      </div><div class="line">      <span class="comment">//3- RQMC, 100 replications, 2^12 trajectories, 20 steps </span></div><div class="line">      PointSetRandomization rand = <span class="keyword">new</span> RandomShift(stream);</div><div class="line">      PointSet p = <span class="keyword">new</span> SobolSequence(12,31,20);</div><div class="line">      brownian.simulRQMC(p,100,20,rand,replicates);</div><div class="line">      System.out.println(<span class="stringliteral">&quot;\n 3- RQMC, 100 reps, 2^12 trajectories, 20 steps&quot;</span>);</div><div class="line">      System.out.println(replicates.report());</div><div class="line">      </div><div class="line">      <span class="comment">//4- Array-RQMC, 100 replications, 2^12 trajectories, 20 steps</span></div><div class="line">      PointSet p2 = <span class="keyword">new</span> SobolSequence(12,31,1);</div><div class="line">      MultiDimSort sort = <span class="keyword">new</span> OneDimSort(0);</div><div class="line">      ArrayOfComparableChains array = </div><div class="line">                              <span class="keyword">new</span> ArrayOfComparableChains(brownian, rand, sort);</div><div class="line">      array.makeCopies(4096);</div><div class="line">      array.simulReplicatesArrayRQMC (p2, rand, sort, 0, 100, 20, replicates);</div><div class="line">      System.out.println(<span class="stringliteral">&quot;\n 4- Array-RQMC, 100 replications&quot;</span> + </div><div class="line">                                              <span class="stringliteral">&quot;, 2^12 trajectories, 20 steps&quot;</span>);</div><div class="line">      System.out.println(replicates.report());</div><div class="line">      </div><div class="line">      <span class="comment">//5- Array-RQMC Simulate and use 2^12 trajectories, 20 steps </span></div><div class="line">      array.makeCopies(4096);</div><div class="line">      array.initialStates();</div><div class="line">      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> step = 1; step &lt; 21; ++step){</div><div class="line">          array.sortChains();</div><div class="line">          array.simulOneStepArrayRQMC (p2);</div><div class="line">          <span class="keywordflow">for</span>(MarkovChainComparable mc: array.getChains()){</div><div class="line">             <span class="comment">//Do something with mc</span></div><div class="line">          }</div><div class="line">      }</div><div class="line">   }</div><div class="line"></div><div class="line">   <span class="keyword">public</span> <span class="keyword">static</span> <span class="keywordtype">void</span> main (String[] args) {</div><div class="line">      <span class="keywordtype">double</span> x0 = 0.0;</div><div class="line">      <span class="keywordtype">double</span> dt = 0.1;       </div><div class="line">      BrownianTest testBrownian = <span class="keyword">new</span> BrownianTest(x0,dt);</div><div class="line">   }</div><div class="line">}</div></div><!-- fragment --><p>The output of this program is displayed in Listing&#160; <a class="el" href="namespaceumontreal_1_1ssj_1_1markovchainrqmc.html#REF_markovchainrqmc_overview_lst_BrownianTestOutput">BrownianTestOutput</a>. For this example, the variance of the estimator with RQMC is 6.25 times less than MC, and 388 times less with array-RQMC compared to MC.</p>
<p><b>Output of BrownianTest.java</b> &emsp;[BrownianTestOutput] <a class="anchor" id="REF_markovchainrqmc_overview_lst_BrownianTestOutput"></a></p><div class="fragment"><div class="line">1- Print trajectory and performance</div><div class="line">step =  0,   position =  0.0</div><div class="line">step =  1,   position = -0.36070</div><div class="line">step =  2,   position = -0.50990</div><div class="line">step =  3,   position = -0.66743</div><div class="line">step =  4,   position = -0.37085</div><div class="line">step =  5,   position = -0.61330</div><div class="line">step =  6,   position = -0.58680</div><div class="line">step =  7,   position = -0.60205</div><div class="line">step =  8,   position = -0.71916</div><div class="line">step =  9,   position = -1.06654</div><div class="line">step = 10,   position = -0.84739</div><div class="line">step = 11,   position = -0.78714</div><div class="line">step = 12,   position = -0.85904</div><div class="line">step = 13,   position = -1.00137</div><div class="line">step = 14,   position = -1.22434</div><div class="line">step = 15,   position = -1.13596</div><div class="line">step = 16,   position = -0.72304</div><div class="line">step = 17,   position = -0.88980</div><div class="line">step = 18,   position = -1.46628</div><div class="line">step = 19,   position = -0.88737</div><div class="line">step = 20,   position = -1.22407</div><div class="line">Performance =  1.22407</div><div class="line"></div><div class="line"> 2- MC, 100 reps, 2^12 trajetories, 20 steps </div><div class="line">REPORT on Tally stat. collector ==&gt; Replicates of Brownian Motion</div><div class="line">    num. obs.     min         max       average    standard dev.</div><div class="line">       100       1.098       1.166       1.130       0.013</div><div class="line"></div><div class="line"></div><div class="line"> 3- RQMC, 100 reps, 2^12 trajectories, 20 steps</div><div class="line">REPORT on Tally stat. collector ==&gt; Replicates of Brownian Motion</div><div class="line">    num. obs.     min         max       average    standard dev.</div><div class="line">       100       1.115       1.140       1.127      5.2E-3</div><div class="line"></div><div class="line"></div><div class="line"> 4- Array-RQMC, 100 replications, 2^12 trajectories, 20 steps</div><div class="line">REPORT on Tally stat. collector ==&gt; Replicates of Brownian Motion</div><div class="line">    num. obs.     min         max       average    standard dev.</div><div class="line">       100       1.126       1.130       1.128      6.6E-4</div><div class="line"></div></div><!-- fragment --> </div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.14
</small></address>
</body>
</html>
